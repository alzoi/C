# Сегменты разделяемой памяти (Общие участки памяти)
[stepik.org/lesson/Средства-межпроцессного-вазимодействия-46413/step/7?course=Операционные-системы&unit=24448](https://stepik.org/lesson/%D0%A1%D1%80%D0%B5%D0%B4%D1%81%D1%82%D0%B2%D0%B0-%D0%BC%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B3%D0%BE-%D0%B2%D0%B0%D0%B7%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D1%8F-46413/step/7?course=%D0%9E%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B5-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B&unit=24448)

Процессы разных приложений могут обмениваться данными через общий сегмент памяти.  

| Функция | Описание |
|:-------:|----------|
| [shmget()](https://linux.die.net/man/2/shmget) | Создание (выделение) общего сегмента (области, участка) памяти определённого размера|
| [shmat()](https://linux.die.net/man/2/shmat) | Присоединение общего участка памяти к адресному пространству процесса (отображение физических страниц общего участка на логические страницы процесса) |
| [shmdt()](https://linux.die.net/man/2/shmdt) | Закрытие, отсоединение общего сегмента памяти. Функция вызывается после завершения работы с общим участком памяти |


Общий участок памяти сохраняется после завершения программы, но при выключении компьютера данные общего участка памяти будут потеряны, так как они хранятся в оперативной, энергозависимой памяти.

```c
#include <sys/types.h>
#include <sys/shm.h>
#include <getopt.h>
#include <unistd.h>
#include <fcntl.h>

#include <string.h>
#include <stdlib.h>
#include <stdio.h>

int main(int argc, char **argv){
	const key_t id = 3148;
  // Размер общего участка памяти.
	const int size = 4096;
  // Получаем общий участок памяти с идентификатором id (если этот участок не существовал, то он будет создан в ОЗУ).
  // Общий участок памяти предствавляется ОС в виде файла, функция возвращает указатель на файл.
	const int fd = shmget(id, size, 0666 | IPC_CREAT);
	if (fd < 0) {
		printf("shmget failed\n");
		return -1;
	}
  // Отображаем адреса общего участка памяти на логическое адресное пространство, получаем указатель на начало участка.
	void *ptr = shmat(fd, (void *)0, 0);

	if (ptr == (void *)-1) {
		printf("shmat failed\n");
		return -1;
	}

	char c;
  // Считываем параметр, указанный при запуске программы.
	while ((c = getopt(argc, argv, "p:g")) != -1) {
		switch (c) {
      case 'p':
        // Записываем 
        strcpy(ptr, optarg);
			  break;
		  case 'g':
			  puts(ptr);
			  break;
		}
	}
	shmdt(ptr);

	return 0;
}
```
